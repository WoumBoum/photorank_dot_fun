{% extends "base.html" %}

{% block content %}
<div class="container">
    <header>
        <h1>Your Stats</h1>
        <nav>
            <a href="/">Vote</a>
            <a href="/leaderboard">Leaderboard</a>
            <a href="/upload">Upload</a>
            <a href="/categories">Categories</a>
            <a href="/login" id="auth-link">Login</a>
            <button class="theme-toggle" id="theme-toggle" title="Toggle dark mode">◐</button>
        </nav>
    </header>

    <div class="stats-section">
        <h2>Your Pseudonym</h2>
        <div style="margin: 1rem 0;">
            <input id="pseudo-input" type="text" placeholder="enter new pseudonym"
                   style="font-family: 'Courier New', monospace; padding: 0.5rem; border: 1px solid #e0e0e0; width: 260px;" />
            <button id="pseudo-save" class="btn" style="margin-left: 0.5rem;">Save</button>
            <span id="pseudo-status" style="margin-left: 0.5rem; font-size: 0.9rem;"></span>
        </div>
        <h2>Your Photos</h2>
        <div class="stats-grid" id="stats-grid">
            <!-- Stats will be loaded here -->
        </div>
        <h2>Your Categories</h2>
        <div id="your-categories" style="margin-top:12px;font-size:0.95em;color:#333;"></div>
        <script>
        document.addEventListener('DOMContentLoaded', async function(){
          try{
            const token = localStorage.getItem('token');
            if(!token) return;
            const me = await (await fetch('/api/users/me', {headers:{'Authorization':'Bearer '+token}})).json();
            const cats = await (await fetch('/api/categories', {headers:{'Authorization':'Bearer '+token}})).json();
            const mine = cats.filter(c=>c.owner_id===me.id);
            const container = document.getElementById('your-categories');
            if(!mine.length){container.textContent='No categories yet.';return;}
            container.innerHTML = mine.map(c=>`<div><a href="/${encodeURIComponent(c.name)}/leaderboard">${c.name}</a> — ${c.question}</div>`).join('');
          }catch(e){console.error(e);}
        });
        </script>
    </div>
</div>
{% endblock %}